# VPC

`VPCはAWSクラウドのネットワークからユーザー専用の領域を切り出すことができる仮想ネットワークのサービス`

- リージョン内に 5 つまで VPC を設定可能（上限緩和申請可能）
- 任意の IP アドレス範囲（CIDR）を選択して仮想ネットワークを構築
  - 最小サイズは/28
  - 最大サイズは/16
- VPC はプライベート IP アドレスによってネットワークレンジを設定
- サブネットの作成、ルートテーブルやネットワークゲートウェイの設定などにより、仮想ネットワーキング環境を完全に制御できる
- 必要に応じてクラウド内外のネットワーク同士を接続したり、外部のネットワークと接続することが可能
- 1 つの VPC と 1 つのサブネットが採用構成。単一サブネットが AZ の範囲に設定される
- 同一リージョン内では、VPC は複数の AZ にリソースを含めることが可能

## CIDR

CIDR に/16 を設定した際に設定可能となるサブネット数と IP アドレスの組み合わせ（AWS 管理 IP の 5 つを引いたもの）

| サブネットマスク | 利用可能な IP アドレス数 |
| :--------------: | :----------------------: |
|       /16        |          65536           |
|       /18        |          16384           |
|       /20        |           4096           |
|       /22        |           1024           |
|       /24        |           356            |
|       /16        |            54            |
|       /28        |            16            |

## サブネット

- サブネットは VPC 内に複数設定でき、1 つの AZ を指定して配置される。（パブリックとプライベートがある）
- インターネットゲートウェイへのルーティング有無でサブネットのタイプが分かれる。
- インターネットに公開される WEB サイトやアプリをパブリックサブネットに、セキュリティを高めたい DB をプライベートサブネットに置くという構成が一般的。
- プライベートサブネット内のインスタンスにインターネットから接続するには踏み台サーバーが必要。（インターネットに返信を返すには NAT ゲートウェイが必要）

## ゲートウェイの設定

VPC コンソールで作成・管理できるゲートウェイは以下。

### インターネットゲートウェイ

- インターネットへの出入り口となるゲートウェイ
- デフォルトゲートウェイとして利用されることが多い
- インターネットゲートウェイを VPC に 1 つ設定する

### NAT ゲートウェイ

- プライベートサブネットのリソースからインターネットへのトラフィックを可能にするためのゲートウェイ
- プライベートアドレスをパブリックアドレスに変換して、インターネットゲートウェイに連携させる

### Egress-Only Internet Gateway

- IPv6 向けのインターネットゲートウェイ
- IPv6 経由での VPC からインターネットへの送信を可能にし、インターネットからのインスタンスへの接続は防ぐ

### カスタマーゲートウェイ

- オンプレミス環境と接続する際に利用するゲートウェイ
- カスタマーゲートウェイデバイスまたはソフトウェアアプリケーションに関する情報を AWS に提供する

### 仮想プライベートゲートウェイ

- 仮想プライベートゲートウェイは、VPC トンネルの Amazon 側にあるルーター
- VPN 接続時に利用する
