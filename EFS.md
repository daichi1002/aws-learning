# EFS

## EFS の概要

### EFS とは何か？

`複数インスタンスで共有して利用できるファイルストレージ。`

#### S3

- オブジェクトストレージでリージョンに設置
- HTTP による API 経由でアクセス
- 大容量のデータを長期保存するためのもの

#### EBS

- ブロックストレージで AZ に設置
- EC2 インスタンスのディスクボリュームとして利用するが、物理的ではなくネットワーク経由で利用
- 複数の EC2 インスタンスにアタッチできない

#### EFS

- NAS に似たファイルストレージ
- ファイルシステムとして利用し、複数の EC2 インスタンスでの共有アクセスが可能
- S3 と異なりインターネットからの直接アクセスができない

### EFS の特徴

`シンプルでスケーラブルで柔軟に利用できるファイルストレージであること`

#### シンプル

- フルマネージド型サービス
- ネットワークファイルシステムバージョン 4(NFS v4)プロトコルを使用して、関連ツールや標準プロトコル/API でアクセス可能（POSIX 準拠）

#### スケーラブル

- ペタバイトまでスケーラブルにデータを蓄積
- スループット/IOPS 性能は自動的にスケーリングし、低レイテンシーを維持

#### 柔軟性

- ファイルの減少に合わせて自動で拡張・縮小
- 事前に容量を設定する必要なし
- 使った分だけの従量課金

### 基本性能

`何千もの同時アクセスが実現可能という性能が特徴的`

#### 基本性能

- スループットを 500MiB/秒（バースト込み）
- 1 ファイルの最大容量 48TB
- インスタンスあたり 128 ユーザーまでの同時オープンが可能
- 何千もの同時アクセスが実現可能

#### 制限

- アカウントあたりのファイルシステム数：1000
- AZ 毎のファイルシステムあたりのマウントターゲット：1
- マウントターゲットあたりのセキュリティグループ：5
- ファイルシステムあたりの VPC 数：1

### ユースケース

`複数EC2インスタンスでデータ共有する際はEFSを利用する`

#### 利用方針

- EBS(IOPS 以外)では構成できない複数インスタンスからの同時アクセス構成が可能
- 数秒単位でのデータ追記が可能
- フルマネージドで運用して簡易に利用していきたい

#### 利用シーン

- アプリケーションの共有ディレクトリとして利用
- ビッグデータなどの分散並列処理環境における共有データアクセスストレージとして利用
- コンテンツの共有リポジトリとして利用

### マウントターゲット

EC2 インスタンスからの接続先のマウントターゲットを設定

- VPC 内の AZ にある接続先
- EC2 インスタンスは同じ AZ 内にあるマウントターゲットから接続する
- 固定の DNS と IP アドレスを有している
- ファイルシステム DNS 名を使用してマウントすることで自動で IP アドレスを付与

### ワンゾーンクラスの利用

低コストなストレージクラスとしてワンゾーンを利用可能

#### ワンゾーン

- 単一アベイラビリティーゾーン内に保存
- ファイルシステムを自動バックアップ
- 頻繁にアクセスされるファイルに使用

#### ワンゾーン IA

- 単一アベイラビリティーゾーン内に保存
- ファイルシステムを自動バックアップ
- たまにしかアクセスされないファイルを保存
- ワンゾーンよりもコストを削減
